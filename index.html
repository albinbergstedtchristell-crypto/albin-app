<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Horror Survival</title>
<style>
body {
    margin: 0;
    background: black;
    font-family: Arial, sans-serif;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

#gameCanvas {
    background: #111;
    border: 3px solid white;
    display: block;
}

#message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 36px;
    color: red;
    text-align: center;
    display: none;
}
</style>
</head>
<body>

<canvas id="gameCanvas" width="640" height="480"></canvas>
<div id="message">GAME OVER!</div>

<audio id="scareSound" src="https://www.soundjay.com/horror/horror-scream-01.mp3"></audio>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const message = document.getElementById('message');
const scareSound = document.getElementById('scareSound');

// Tile-storlek
const tileSize = 32;
const cols = canvas.width / tileSize;
const rows = canvas.height / tileSize;

// Spelare
let player = {x:1, y:1, width:28, height:28, color:'yellow', hasKey:false};

// Monster
let monster = {x:cols-3, y:rows-3, width:28, height:28, color:'red', speed:0.05};

// Nyckel
let key = {x:cols-5, y:2, width:28, height:28, color:'gold', picked:false};

// Dörr
let door = {x:cols-2, y:rows-2, width:28, height:28, color:'green'};

// Väggar (enkel labyrint)
let walls = [];
for(let i=0;i<cols;i++){
    walls.push({x:i, y:0});
    walls.push({x:i, y:rows-1});
}
for(let i=0;i<rows;i++){
    walls.push({x:0, y:i});
    walls.push({x:cols-1, y:i});
}
// extra väggar
walls.push({x:4,y:4},{x:4,y:5},{x:4,y:6},{x:7,y:7},{x:7,y:8},{x:7,y:9});

// Tangenter
let keysPressed = {};
document.addEventListener('keydown', e=>{ keysPressed[e.key] = true; });
document.addEventListener('keyup', e=>{ keysPressed[e.key] = false; });

// Kollisionscheck
function collides(x,y){
    for(let w of walls) if(w.x===x && w.y===y) return true;
    return false;
}

// Game Loop
function gameLoop(){
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

// Uppdatering
function update(){
    // Spelare
    let newX = player.x;
    let newY = player.y;
    if(keysPressed['ArrowLeft']) newX -= 0.2;
    if(keysPressed['ArrowRight']) newX += 0.2;
    if(keysPressed['ArrowUp']) newY -= 0.2;
    if(keysPressed['ArrowDown']) newY += 0.2;

    // Runda av för tilekollision
    let tileX = Math.floor(newX+0.5);
    let tileY = Math.floor(newY+0.5);
    if(!collides(Math.floor(newX), Math.floor(player.y))) player.x = newX;
    if(!collides(Math.floor(player.x), Math.floor(newY))) player.y = newY;

    // Plocka nyckel
    if(!key.picked && Math.floor(player.x) === key.x && Math.floor(player.y) === key.y){
        key.picked = true;
        player.hasKey = true;
        alert("Du tog nyckeln!");
    }

    // Öppna dörr
    if(player.hasKey && Math.floor(player.x) === door.x && Math.floor(player.y) === door.y){
        alert("Grattis! Du klarade spelet!");
        resetGame();
    }

    // Monster AI – jagar spelaren
    let dx = player.x - monster.x;
    let dy = player.y - monster.y;
    let dist = Math.sqrt(dx*dx + dy*dy);
    if(dist>0){
        monster.x += (dx/dist) * monster.speed;
        monster.y += (dy/dist) * monster.speed;
    }

    // Kollision med monster
    if(Math.floor(player.x) === Math.floor(monster.x) && Math.floor(player.y) === Math.floor(monster.y)){
        gameOver();
    }
}

// Rita
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Väggar
    for(let w of walls){
        ctx.fillStyle='gray';
        ctx.fillRect(w.x*tileSize, w.y*tileSize, tileSize, tileSize);
    }

    // Dörr
    ctx.fillStyle=door.color;
    ctx.fillRect(door.x*tileSize, door.y*tileSize, tileSize, tileSize);

    // Nyckel
    if(!key.picked){
        ctx.fillStyle=key.color;
        ctx.fillRect(key.x*tileSize, key.y*tileSize, tileSize, tileSize);
    }

    // Monster
    ctx.fillStyle=monster.color;
    ctx.fillRect(monster.x*tileSize, monster.y*tileSize, monster.width, monster.height);

    // Spelare
    ctx.fillStyle=player.color;
    ctx.fillRect(player.x*tileSize, player.y*tileSize, player.width, player.height);
}

// Game over
function gameOver(){
    message.style.display='block';
    scareSound.play();
    setTimeout(()=>{
        message.style.display='none';
        resetGame();
    },2000);
}

// Reset
function resetGame(){
    player = {x:1, y:1, width:28, height:28, color:'yellow', hasKey:false};
    monster = {x:cols-3, y:rows-3, width:28, height:28, color:'red', speed:0.05};
    key.picked = false;
}

gameLoop();
</script>
</body>
</html>
