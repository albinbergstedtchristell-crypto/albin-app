<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Skräckäventyr</title>
<style>
body {
    margin: 0;
    background: black;
    color: white;
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

#gameCanvas {
    background: #111;
    border: 3px solid white;
    display: block;
}
#message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 32px;
    color: red;
    display: none;
    text-align: center;
}
</style>
</head>
<body>

<canvas id="gameCanvas" width="600" height="600"></canvas>
<div id="message">GAME OVER!</div>

<audio id="scareSound" src="https://www.soundjay.com/horror/horror-scream-01.mp3"></audio>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const message = document.getElementById('message');
const scareSound = document.getElementById('scareSound');

const grid = 30; // storlek på rutor
const cols = canvas.width / grid;
const rows = canvas.height / grid;

// Spelare
let player = {x:1, y:1, color:'yellow', hasKey:false};

// Monster
let monster = {x:10, y:10, color:'red', dirX:1, dirY:0};

// Föremål (nyckel)
let key = {x:5, y:5, color:'gold', picked:false};

// Dörr
let door = {x:cols-2, y:rows-2, color:'green'};

// Väggar (enkel labyrint)
let walls = [];
for(let i=0;i<cols;i++){
    walls.push({x:i, y:0});
    walls.push({x:i, y:rows-1});
}
for(let i=0;i<rows;i++){
    walls.push({x:0, y:i});
    walls.push({x:cols-1, y:i});
}
// extra väggar
walls.push({x:3,y:3},{x:3,y:4},{x:3,y:5},{x:6,y:6},{x:6,y:7},{x:6,y:8});

// Tangenter
let keys = {};
document.addEventListener('keydown', e=>{ keys[e.key]=true; });
document.addEventListener('keyup', e=>{ keys[e.key]=false; });

// Kollisionscheck
function collides(x,y){
    for(let w of walls) if(w.x===x && w.y===y) return true;
    return false;
}

// Game Loop
let lastTime = 0;
function gameLoop(time=0){
    const delta = time - lastTime;
    if(delta > 150){ // hastighet
        lastTime = time;
        update();
        draw();
    }
    requestAnimationFrame(gameLoop);
}

// Uppdatering
function update(){
    // Spelare
    let newX = player.x;
    let newY = player.y;
    if(keys['ArrowLeft']) newX--;
    if(keys['ArrowRight']) newX++;
    if(keys['ArrowUp']) newY--;
    if(keys['ArrowDown']) newY++;

    if(!collides(newX,newY)){
        player.x = newX;
        player.y = newY;
    }

    // Plocka upp nyckel
    if(!key.picked && player.x===key.x && player.y===key.y){
        key.picked = true;
        player.hasKey = true;
        alert("Du tog nyckeln!");
    }

    // Öppna dörr
    if(player.hasKey && player.x===door.x && player.y===door.y){
        alert("Grattis! Du klarade spelet!");
        resetGame();
    }

    // Monster rör sig
    monster.x += monster.dirX;
    monster.y += monster.dirY;

    if(collides(monster.x,monster.y)){
        monster.dirX *= -1;
        monster.dirY *= -1;
        monster.x += monster.dirX;
        monster.y += monster.dirY;
    }

    // Monster jagar spelare
    if(Math.random()<0.5){
        if(player.x>monster.x) monster.x++;
        if(player.x<monster.x) monster.x--;
    } else {
        if(player.y>monster.y) monster.y++;
        if(player.y<monster.y) monster.y--;
    }

    // Kollision med monster
    if(player.x===monster.x && player.y===monster.y){
        gameOver();
    }
}

// Rita
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Väggar
    for(let w of walls){
        ctx.fillStyle='gray';
        ctx.fillRect(w.x*grid, w.y*grid, grid, grid);
    }

    // Dörr
    ctx.fillStyle = door.color;
    ctx.fillRect(door.x*grid, door.y*grid, grid, grid);

    // Nyckel
    if(!key.picked){
        ctx.fillStyle = key.color;
        ctx.fillRect(key.x*grid, key.y*grid, grid, grid);
    }

    // Monster
    ctx.fillStyle = monster.color;
    ctx.fillRect(monster.x*grid, monster.y*grid, grid, grid);

    // Spelare
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x*grid, player.y*grid, grid, grid);
}

// Game over
function gameOver(){
    message.style.display='block';
    scareSound.play();
    setTimeout(()=>{
        message.style.display='none';
        resetGame();
    },2000);
}

// Reset
function resetGame(){
    player = {x:1, y:1, color:'yellow', hasKey:false};
    monster = {x:10, y:10, color:'red', dirX:1, dirY:0};
    key.picked = false;
}

gameLoop();
</script>
</body>
</html>
